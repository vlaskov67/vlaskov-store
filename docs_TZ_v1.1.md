# Техническое задание (ТЗ) проекта «Vlaskov»

> **Версия:** 1.1\
> **Дата:** 21 апреля 2025 г.\
> **Ответственный:** Product Owner / CTO\
> **Контакты:** [tech@vlaskov.com](mailto\:tech@vlaskov.com)
>
> В каждом обсуждении фиксируем итог пометкой **#Decision**.

---

## 1. Введение

### 1.1 Цели

Создать масштабируемый мульти‑региональный интернет‑магазин аксессуаров для техники с возможностью плавного перехода от дропшиппинга к собственному бренду.

### 1.2 Задачи

- Обеспечить единое ядро кода, поддерживающее 5 регионов с разными доменами, валютами и платёжными методами.
- Реализовать полный e‑commerce функционал (каталог, корзина, чек‑аут, личный кабинет, админ‑панель).
- Интегрировать внешние сервисы: оплату, доставку, коммуникации, AI‑чат‑бот.
- Соблюсти требования GDPR и обеспечить высокую производительность.

### 1.3 Область применения

Веб‑приложение (desktop + mobile) и backend API. Native‑приложения вне рамок текущего ТЗ.

---

## 2. Термины и определения

| Термин               | Описание                                                                                                |
| -------------------- | ------------------------------------------------------------------------------------------------------- |
| **Region**           | CH, UK, EU, US, INTL — логическая и доменная единица с собственными настройками оплаты, валюты и языка. |
| **SKU**              | Уникальный вариант товара (модель + цвет).                                                              |
| **Livewire‑модалка** | Компонент Livewire, открываемый поверх контента без перезагрузки страницы.                              |
| **Capture**          | Финальное списание средств при оплате.                                                                  |

---

## 3. Общее описание системы

### 3.1 Бизнес‑модель

- **Старт:** дропшиппинг от поставщиков.
- **Рост:** переход на собственный бренд и склад.

### 3.2 Домены и мультирегиональность

```
CH   → vlaskov.ch   → CHF
UK   → vlaskov.uk   → GBP
US   → vlaskov.us   → USD
EU   → vlaskov.eu   → EUR
INTL → vlaskov.com  → EUR (только выбор региона)
```

- GeoIP‑middleware предлагает выбор региона (cookie `region_override`, TTL = 30 дней).
- Параметр `?noredirect=1` отключает редирект.

### 3.3 Технический стек

| Слой        | Технологии                        |
| ----------- | --------------------------------- |
| Backend     | Laravel 10, Blade, Eloquent       |
| Frontend    | Livewire + Alpine.js, TailwindCSS |
| БД          | MySQL 8 (см. `db-schema.png`)     |
| CI/CD       | GitHub Actions → Bluehost (prod)  |
| Storage/CDN | AWS S3 + Cloudflare               |
| Monitoring  | Sentry, New Relic                 |

---

## 4. Функциональные требования

### 4.1 Каталог и карточка товара

- Поиск, фильтры (модель, бренд, цена, цвет).
- Изображения WebP, lazy load, ресайзы.
- Кросс‑селл блок «Часто берут вместе» (на ML‑данных).
- **Навигация по каталогу (см. сценарий 9.2):**
  - Селектор модели, превью цветов, модальное окно варианта, возврат «Back» c сохранением состояния.

### 4.2 Корзина и оформление заказа

- Livewire‑корзина в шапке.
- Guest checkout с e‑mail + телефон подтверждением (reCAPTCHA v2).
- Разные платёжные методы по регионам (табл. 6.1).
- Моментальный capture, страница «Спасибо», авто‑email / SMS.

### 4.3 Пользовательский кабинет

- Секции: **Заказы**, **Детали заказа**, **Возвраты**, **Лояльность**, **Подписка**.
- Интеграция Ship24 (ручной refresh, cron 15 мин).
- Workflow возвратов: `requested → approved → returned → completed`.

### 4.4 Админ‑панель

- CRUD‑каталог, CSV импорт/экспорт.
- WYSIWYG‑страницы/блог/SEO/FAQ.
- Маркетинг: купоны, cart‑abandonment, A/B‑тесты, баннеры.
- Интеграции и системные настройки.

### 4.5 Чат‑бот (OpenAI)

- Виджет на сайте: 5 языков.
- Гостям — FAQ, авторизованным — статусы заказов и возвраты.
- Handover триггеры (3× «не знаю», жалоба, явный запрос).
- Контекст 10 сообщений, хранение 30 дней.

### 4.6 Промокоды и акции

- Livewire‑валидация кода, лимиты, coupon\_redemptions.
- Система баллов лояльности.

### 4.7 Регистрация, вход, восстановление

- 5 попыток входа / 15 мин, SMS/E‑mail восстановление.

---

## 5. Нефункциональные требования

| Категория             | Требование                                                           |
| --------------------- | -------------------------------------------------------------------- |
| Производительность    | TTFB ≤ 150 мс для главной (из CDN), Time‑to‑Interactive ≤ 3 с (P95). |
| Масштабируемость      | Горизонтальное масштабирование Laravel (stateless), S3 storage.      |
| Безопасность          | SSL, Cloudflare WAF, ограничение логинов, XSS/CSRF защита.           |
| GDPR                  | Cookie‑banner, right‑to‑be‑forgotten, двойное согласие newsletters.  |
| Локализация           | i18n (en, de, fr, it, ru), число/валюта в локальном формате.         |
| Доступность           | WCAG 2.1 AA.                                                         |
| Резервное копирование | DB + storage — ежедневные бэкапы, retention 30 дней.                 |
| Мониторинг            | Error rate < 1 %, алерт при latency > 500 мс (P95).                  |

---

## 6. Интеграции

### 6.1 Платёжные методы

| Регион | Методы                                      |
| ------ | ------------------------------------------- |
| CH     | Stripe, **Twint**                           |
| UK     | Stripe, Apple Pay, Google Pay, **Clearpay** |
| EU     | Stripe, **Klarna**, **iDEAL**, **Sofort**   |
| US     | Stripe, Apple Pay, Google Pay, **ACH**      |
| INTL   | Stripe (карты)                              |

### 6.2 Прочие сервисы

| Назначение  | Сервис     | Частота                                     |
| ----------- | ---------- | ------------------------------------------- |
| Трекинг     | Ship24     | cron 15 мин + по клику                      |
| SMS         | Twilio     | real‑time                                   |
| Email       | SendGrid   | real‑time (обработка bounce & spam\_report) |
| Курсы валют | Fixer.io   | ежедневный cron                             |
| AI бот      | OpenAI API | on‑request                                  |

---

## 7. Архитектура и дизайн

- **MVC** Laravel, разделение слоёв: Controllers ↔ Services ↔ Repositories.
- Livewire компоненты для реактивного UI.
- Alpine.js для мелких интерактивных эффектов.
- **CDN** раздаёт статику и преобразованные изображения.
- ER‑диаграмма — см. `db-schema.png`.

### 7.1 Потоки данных

1. Пользователь выбирает регион → cookie → редирект.
2. При заказе создаётся `orders` + `order_items` + Stripe PaymentIntent.
3. Cron‑задача обновляет `shipment_events` (Ship24 API).

---

## 8. Роли и права доступа

| Роль       | Возможности                                |
| ---------- | ------------------------------------------ |
| superadmin | Все + настройки регионов, GPT‑prompts.     |
| admin      | Всё, кроме GeoIP‑логики и системных ключей |
| marketing  | A/B‑тесты, купоны, рассылки                |
| content    | Страницы, блог, SEO, каталог               |
| support    | Чаты, отзывы, возвраты                     |
| user       | Покупки, трекинг, лояльность               |

---

## 9. UX/UI требования

- Макеты см. `wireframes/`, стиль — `style-guide.pdf`.
- Grid‑layout, округлые углы 2xl, тени md, padding ≥ p‑2.
- Ховер‑эффекты: превью цвета, плавное затухание.
- Адаптив: mobile ≥ 360 px ширина.

---

## 10. CI/CD и среда

- **GitHub Actions**: lint → unit tests → integration → build → deploy.
- Прогоны на PHP 8.3, Node 20.
- prod — Bluehost; stage — отдельный S3+RDS.

---

## 11. Данные и хранение

- Таблицы согласно ER‑диаграмме.
- Хранение файлов — S3, префикс `region/YYYY/MM/`.
- Логи ⬅️ Cloudflare → S3 → Glacier через 30 дней.

---

## 12. Миграции и версионирование

- Laravel Migrations, semver (`vX.Y.Z`).
- Запрет прямых изменений схемы без миграции.

---

## 13. Локализация

- Словари JSON в `resources/lang/{locale}`.
- Базовые языки — en, de, fr, it, ru.
- Отдельные маркетинговые тексты в БД для A/B‑тестов.

---

## 14. Тестирование и QA

| Тип           | Охват                                    |
| ------------- | ---------------------------------------- |
| Unit          | Модели, сервисы (≥ 80 % coverage)        |
| Integration   | Оплаты, Ship24, Twilio, OpenAI           |
| E2E           | Главный пользовательский поток (Cypress) |
| Accessibility | a11y‑lint, ручные проверки               |
| Performance   | Lighthouse CI, New Relic APM             |

---

## 15. Мониторинг и алерты

- **Sentry** — ошибки уровня `error ≥ 5/min`.
- **New Relic** — P95 latency, throughput.
- **PagerDuty** — критические инциденты.

---

## 16. Поддержка и операции

- Логи retention 30 дней, затем архив.
- Change‑management — pull‑requests + code‑review.
- SLA прод — uptime ≥ 99.8 %.

---

## 17. Масштабирование и future‑work

- Кеш Redis/ElastiCache.
- Возможность выделить каталог в headless‑API.
- Mobile PWA.

---

## 18. План и вехи (Milestones)

| № | Веха                    | Описание                    | Срок         |
| - | ----------------------- | --------------------------- | ------------ |
| 1 | Архитектура + Dev setup | Repo, CI/CD, базовые модели | 15 мая 2025  |
| 2 | Каталог + поиск         | CRUD товаров, фильтры       | 15 июня 2025 |
| 3 | Корзина + чек‑аут       | Оплаты CH / EU / US         | 30 июля 2025 |
| 4 | Личный кабинет          | Заказы, трекинг, возвраты   | 31 авг 2025  |
| 5 | Админ‑панель MVP        | Контент, купоны             | 30 сент 2025 |
| 6 | AI‑чат‑бот              | FAQ, статус заказа          | 31 окт 2025  |
| 7 | Go‑live CH / EU         | Marketing, SEO, A/B         | 30 нояб 2025 |

---

## 19. Критерии приёмки

1. Прохождение всех e2e тестов в stage.
2. Отсутствие критических ошибок в Sentry 24 ч.
3. TTI ≤ 3 с (P95) для главных страниц.
4. Успешный платёж и трекинг в каждом регионе.

---

## 20. Приложения

- **A.** `db-schema.png` — ER‑диаграмма.
- **B.** `api-spec.postman_collection.json` — REST / GraphQL вызовы.
- **C.** `wireframes/` — макеты UI.
- **D.** `style-guide.pdf` — визуальный гид.
- **E.** `gpt-prompts.md` — system / assistant промпты.

---

>

